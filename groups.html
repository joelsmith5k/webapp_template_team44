  <html>
    <head>
      <meta charset="utf-8" />
      <title>Groups</title>
      <meta name="comp1800 boilerplate code" content="my bcit project" />
      <meta name="author" content="BCIT" />

      <!-- Bootstrap for Mobile-first, and JQuery -->
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, shrink-to-fit=no"
      />
      <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
        crossorigin="anonymous"
      />
      <link
        type="text/css"
        rel="stylesheet"
        href="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.css"
      />
      <!-- Optional styles and scripts of your own -->
      <link rel="stylesheet" href="groups.css">
  </head>

  <body style="background-color: #333333;">
    <!-------------------------------------->
    <!-- The following is HTML for layout -->
    <!-------------------------------------->
    <!-- Header Navigation Bar -->
    <nav class="navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Cineder</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#"
                >Swiping Page</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Group Settings</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Matches</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <p></p>
    <div class="container" id = "topDescription">
      <h1 class="h4 topMessage">Choose a group to compare your preferences with:</h1>
    </div>

    <div>
        <p></p>
    </div>

    <div id = "groupCardDiv">

    </div>

    <!-- <div id = "createGroupDiv">
      <button type="button" class="btn btn-secondary btn-lg">Large button</button>
    </div> -->
      <!----------------------------------------------->
      <!-- JS: Boostrap, Firebase, API related    -->
      <!----------------------------------------------->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"
      ></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
      <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script>
      <!-- Link to the api keys for your firebase project -->
      <script src="scripts/firebase_api_joel.js"></script>

      <!--------------------------------------------------------------------->
      <!-- JS files: Your own JavaScript functions included here    -->
      <!--------------------------------------------------------------------->
      <script>
        function displayGroups(){
          db.collection("groups")
          .get()
          .then(function(snap){

          var groupCounter = 1
          var buttonCounter = 1

          snap.forEach(function(doc){

          var groupName = doc.data().name;
          var groupDescription = doc.data().description;
          var groupImageChoice = doc.data().photo;

          var groupContainer = document.createElement('div');
          groupContainer.setAttribute('class', "container");

          var groupGrid = document.createElement('div');
          groupGrid.setAttribute('class', "row row-cols-1 row-cols-md-2 g-4");

          var groupCol = document.createElement('div');
          groupCol.setAttribute('class', "col");

          var groupBox = document.createElement('div');
          groupBox.setAttribute('class', "card groupBox");

          var groupImage = document.createElement('img');
          var groupImageSource = "./images/"+ groupImageChoice + ".jpg"
          groupImage.setAttribute('src', groupImageSource);
          groupImage.setAttribute('class', "card-img-top");

          var groupBody = document.createElement('div');
          groupBody.setAttribute('class', "card-body");
          
          // Here, we are setting Id for each Title, starting with groupName1, then groupName2, etc..
          var groupTitle = document.createElement('h5');
          groupTitle.setAttribute('class', "card-title");
          groupTitle.setAttribute('id', "groupName" + groupCounter);
          groupCounter += 1
          console.log(groupTitle.id)
          groupTitle.appendChild(document.createTextNode(groupName));

          var groupText = document.createElement('p');
          groupText.setAttribute('class', "card-text");
          groupText.appendChild(document.createTextNode(groupDescription));

          // linked = document.createElement('a');
          // let newPage = './artist.html?num=' + artistNumberText + '&name=' + artistNameText
          // linked.setAttribute('href', newPage);
          // linked.appendChild(artistCard);
          // linked.setAttribute('id', 'linkedBox');

          var groupSelect = document.createElement('button');
          groupSelect.setAttribute('class', "btn matchingButton");
          groupSelect.setAttribute('type', "button");
          groupSelect.setAttribute('id', "startMatching" + buttonCounter);
          buttonCounter += 1
          console.log(groupSelect.id)
          groupSelect.appendChild(document.createTextNode("Start Matching!"));

          groupBody.appendChild(groupTitle)
          groupBody.appendChild(groupText)
          groupBody.appendChild(groupSelect)

          groupBox.appendChild(groupImage)
          groupBox.appendChild(groupBody)

          groupCol.appendChild(groupBox)

          groupGrid.appendChild(groupCol)

          groupContainer.appendChild(groupGrid)

          var domDiv = document.getElementById("groupCardDiv")
          domDiv.appendChild(groupContainer)
        
            }) 
          })
        }
        displayGroups();

// // -----------------------------------------------------------------------------------------------------------------
        function applyListeners(){
          let allButtons = document.querySelectorAll(".btn.matchingButton");
          let allButtonsArray = Array.prototype.slice.call(allButtons);

          allButtonsArray.forEach(function(button){
            var choiceNumber = button.id[button.id.length - 1]
            button.addEventListener("click", joinTheGroup(choiceNumber))
          })
        }

        var joinTheGroup = function(choiceNumber){
          return function curriedFunction(choiceNumber){

            firebase.auth().onAuthStateChanged(function(user){
            db.collection("userstwo").doc(user.uid).get().then(function(doc){

              groupTitleInside = document.getElementById("groupName" + choiceNumber.target.id[choiceNumber.target.id.length - 1])
              var groupNameToAdd = groupTitleInside.innerHTML
              var objectToAdd = {"current group": groupNameToAdd}

              db.collection("userstwo").doc(user.uid).update(objectToAdd).then(() => {
                console.log("Document successfully written!")

                setTimeout(function () {
                  window.location.href = "./swipe.html"; // this delay allows it to write to DB before redirect
                }, 1000);

              })
            })
          })
        }
      }

        setTimeout(applyListeners, 2000);
    
      </script>
    </body>
  </html>

  <!-- Version that writes a hard-coded string to the new field current group in the db -->
  <!-- function joinAGroup() {

    firebase.auth().onAuthStateChanged(function (user) {
    db.collection("userstwo").doc(user.uid).get().then(function(doc) {

      console.log(user.uid)
      console.log(doc.data())
      console.log(doc.data().name)

      var groupChoice = {"current group": "selected group 80!.."}

      db.collection("userstwo").doc(user.uid).update(groupChoice).then(() => {
      console.log("Document successfully written!");
          });
      }); 
    });
  } 

setTimeout(joinAGroup, 2000); -->

  <!-- Version trying to add event lister to each button-->
  <!-- function joinAGroup() {

    firebase.auth().onAuthStateChanged(function (user) {
    db.collection("userstwo").doc(user.uid).get().then(function(doc) {

      let allButtons = document.querySelectorAll(".btn.matchingButton");
      let allButtonsArray = Array.prototype.slice.call(allButtons);

      allButtonsArray.forEach(function(button){
      button.addEventListener("click", function(){
        
        groupTitleInside = document.getElementById("groupName" + button[-1])
        console.log(groupTitleInside)
      
        var groupChoice = {"current group": groupTitleInside}

        db.collection("userstwo").doc(user.uid).update(groupChoice).then(() => {
        console.log("Document successfully written!");
      });

        console.log(button.id);
        this.style.backgroundColor = "#ff0";

      });
    });

      // console.log(user.uid)
      // console.log(doc.data())
      // console.log(doc.data().name)
      }); 
    });
  } 

setTimeout(joinAGroup, 2000); -->

<!-- // ----------------  // working right now but can't pass the choice number into the next function, trying another way below. ------------------------
        // function applyListeners(){
        //   let allButtons = document.querySelectorAll(".btn.matchingButton");
        //   let allButtonsArray = Array.prototype.slice.call(allButtons);

        //   console.log(allButtonsArray)
          
        //   allButtonsArray.forEach(function(button){
        //     console.log(button)
        //     var choiceNumber = button.id[button.id.length - 1]
        //     button.addEventListener("click", function(choiceNumber){
        //       console.log(choiceNumber)
        //       firebase.auth().onAuthStateChanged(function (user) {
        //       db.collection("userstwo").doc(user.uid).get().then(function(doc) {

        //       // console.log(button.id)
        //       // someObj.addEventListener("click", some_func.bind(null, some_other_func), false);
        //       console.log(user.uid)
        //       console.log(doc.data())
        //       console.log(doc.data().name)

        //       var groupChoice = {"current group": "selected group 84!.."}

        //       db.collection("userstwo").doc(user.uid).update(groupChoice).then(() => {
        //       console.log("Document successfully written!");
        //           });
        //       }); 
        //     });
          
        //     })
              
        //     })
        // }

        // setTimeout(applyListeners, 2000); -->