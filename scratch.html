<html>
    <head>
      <meta charset="utf-8" />
      <title>Scratch</title>
      <meta name="comp1800 boilerplate code" content="my bcit project" />
      <meta name="author" content="BCIT" />

      <!-- Bootstrap for Mobile-first, and JQuery -->
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, shrink-to-fit=no"
      />
      <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl"
        crossorigin="anonymous"
      />
      <link
        type="text/css"
        rel="stylesheet"
        href="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.css"
      />
      <!-- Optional styles and scripts of your own -->
      <link rel="stylesheet" href="groups.css">
  </head>

  <body style="background-color: #333333;">
    <!-------------------------------------->
    <!-- The following is HTML for layout -->
    <!-------------------------------------->
    <!-- Header Navigation Bar -->
    <nav class="navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Cineder</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#"
                >Swiping Page</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Group Settings</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Matches</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <p></p>
    <div class="container" id = "topDescription">
      <h1 class="h4 topMessage">Choose a group to compare your preferences with:</h1>
    </div>

    <div>
        <p></p>
    </div>

    <div id = "informationDiv">

    </div>

    <!-- <div id = "createGroupDiv">
      <button type="button" class="btn btn-secondary btn-lg">Large button</button>
    </div> -->
      <!----------------------------------------------->
      <!-- JS: Boostrap, Firebase, API related    -->
      <!----------------------------------------------->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
        crossorigin="anonymous"
      ></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/8.2.9/firebase-firestore.js"></script>
      <script src="https://www.gstatic.com/firebasejs/ui/4.6.1/firebase-ui-auth.js"></script>
      <!-- Link to the api keys for your firebase project -->
      <script src="scripts/firebase_api_joel.js"></script>

      <!--------------------------------------------------------------------->
      <!-- JS files: Your own JavaScript functions included here    -->
      <!--------------------------------------------------------------------->

      <script>
        
        // Find the current users group name, pass this information to findAllUsers function
        function runMatchesPage(){

            firebase.auth().onAuthStateChanged(function (user) {

            var docRef = db.collection("userstwo").doc(user.uid);

            docRef.get().then((doc) => {

                console.log("Document data:", doc.data());
                currentGroup = doc.data().current_group;
                // console.log(currentGroup)
                findAllUsers(currentGroup)
                })
            })
        }

        
        // Find all users that are in the same group, create a list, containing lists of their desired movies. 
        // Pass this master list to sortAndMatch
        function findAllUsers(currentGroup){

            db.collection("userstwo").where("current_group", "==", currentGroup)
            .get()
            .then((querySnapshot) => {

                var allMoviesList = []
                querySnapshot.forEach((doc) => {
                    // doc.data() is never undefined for query doc snapshots
                    // console.log(doc.id, " => ", doc.data());
                    allMoviesList.push(doc.data().desired_movies)
                    // console.log(trial_list)     
                });

                sortAndMatch(allMoviesList)
            })
        }

        // Combine the list of lists into one large list containing every single element
        function sortAndMatch(allMoviesList){

            var combinedMovies = [];

            for (var i = 0; i < allMoviesList.length; i++) {
                var theList = allMoviesList[i];
                for (var j = 0; j < theList.length; j++) {
                    combinedMovies.push(theList[j]);
                }
            }

        // Create the object that includes each movie and it's count, no duplicates
            var countedMovies = {};

            combinedMovies.forEach(function(movie) {

                if (countedMovies.hasOwnProperty(movie)) {countedMovies[movie]++} 

                else {countedMovies[movie] = 1}

            });

        // maybe pass this object to one final function that creates and displays the DOM's?
            console.log(countedMovies); 
    
        }


            runMatchesPage();

    </script>
    </body>
  </html>